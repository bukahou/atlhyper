# AtlHyper Web - 功能规格书 (SPEC)

## 1. 项目概述

### 1.1 项目目标

将 AtlHyper 现有的 Vue 2 前端重构为 Next.js 16 + React 19 + TypeScript 架构，实现与后端的完全解耦。

### 1.2 技术栈

| 类别 | 技术 | 版本 |
|------|------|------|
| 框架 | Next.js | 16.x |
| UI库 | React | 19.x |
| 语言 | TypeScript | 5.x |
| 样式 | Tailwind CSS | 4.x |
| 状态管理 | Zustand | 5.x |
| 图标 | Lucide React | latest |
| 图表 | ECharts | 5.x |
| HTTP | axios | latest |

### 1.3 品牌标识

| 项目 | 图标 | 主题色 |
|------|------|--------|
| Geass | geass 图标 | 淡紫色 |
| Atlantis | geass 图标 | 淡蓝色 |
| **AtlHyper** | **geass 图标** | **淡绿蓝色 (teal/cyan)** |

### 1.4 项目结构

```
atlhyper_web/
├── src/
│   ├── app/                    # 页面路由 (App Router)
│   │   ├── (auth)/             # 认证相关路由组
│   │   │   └── login/
│   │   ├── (dashboard)/        # 主控制台路由组（无需登录可访问）
│   │   │   ├── analysis/
│   │   │   ├── workbench/
│   │   │   ├── cluster/
│   │   │   ├── system/
│   │   │   └── settings/
│   │   ├── layout.tsx
│   │   └── page.tsx
│   ├── api/                    # API 层
│   │   ├── core/
│   │   │   └── request.ts      # Axios 封装
│   │   ├── auth.ts
│   │   ├── pod.ts
│   │   ├── node.ts
│   │   ├── deployment.ts
│   │   ├── service.ts
│   │   ├── namespace.ts
│   │   ├── metrics.ts
│   │   └── config.ts
│   ├── components/
│   │   ├── layout/
│   │   ├── navigation/
│   │   ├── cluster/
│   │   ├── charts/
│   │   ├── auth/               # 认证相关组件
│   │   └── ui/
│   ├── store/
│   │   ├── authStore.ts
│   │   ├── clusterStore.ts
│   │   └── settingsStore.ts
│   ├── types/
│   │   ├── index.ts
│   │   ├── auth.ts
│   │   ├── cluster.ts
│   │   ├── pod.ts
│   │   ├── node.ts
│   │   ├── i18n.ts
│   │   └── common.ts
│   ├── i18n/                   # 国际化
│   │   ├── context.tsx         # I18n Provider
│   │   ├── locales/
│   │   │   ├── zh.ts           # 中文
│   │   │   └── ja.ts           # 日文
│   │   └── index.ts
│   ├── theme/                  # 主题系统
│   │   └── context.tsx         # Theme Provider
│   ├── lib/
│   │   └── utils.ts
│   └── styles/
│       └── globals.css
├── public/
│   ├── logo.png                # geass 图标（淡绿蓝色）
│   ├── favicon-32.png
│   └── favicon-16.png
└── package.json
```

---

## 2. 核心设计原则

### 2.1 访问控制策略

**重要变更**: 取消初始登录要求，采用分级访问控制。

| 操作类型 | 需要登录 | 说明 |
|---------|---------|------|
| 浏览/查看 | 否 | 所有页面可直接访问，方便开源项目了解 |
| 修改/操作 | 是 | Pod 重启、Node drain 等操作需登录 |
| 配置变更 | 是 | Slack 配置、用户管理等需登录 |

**实现方式**:
- 页面级别: 无路由守卫，所有页面可直接访问
- 操作级别: 操作按钮触发时检查登录状态
- 未登录时: 弹出登录对话框，登录后继续操作

### 2.2 国际化 (i18n)

支持中日双语切换，参考 atlantis 项目实现。

| 语言 | 代码 | 默认 |
|------|------|------|
| 中文 | zh | 是 |
| 日本語 | ja | 否 |

### 2.3 主题系统

支持亮色/暗色模式切换，参考 atlantis 项目实现。

| 模式 | 说明 |
|------|------|
| light | 亮色模式 |
| dark | 暗色模式 |
| system | 跟随系统 |

### 2.4 响应式布局

支持多端适配。

| 断点 | 宽度 | 布局 |
|------|------|------|
| mobile | < 768px | 单栏，底部导航 |
| tablet | 768px - 1024px | 可折叠侧边栏 |
| desktop | > 1024px | 固定侧边栏 |

---

## 3. 功能需求 (FR)

### FR-001: 认证系统（操作级别）

**优先级**: P0
**依赖**: 无

**描述**:
操作级别的认证系统。浏览无需登录，操作时检查登录状态。

**验收标准**:
- [ ] 登录对话框（非页面）包含用户名和密码字段
- [ ] 登录成功后 Token 存储在 localStorage
- [ ] 操作按钮点击时检查登录状态
- [ ] 未登录时弹出登录对话框
- [ ] 登录后自动继续之前的操作
- [ ] Token 过期时提示重新登录
- [ ] 顶部栏显示登录状态

**API 依赖**:
| 方法 | 路径 | 描述 |
|------|------|------|
| POST | /api/uiapi/user/login | 用户登录 |
| POST | /api/uiapi/user/info | 获取用户信息 |
| POST | /api/uiapi/user/logout | 用户登出 |

**UI 组件**:
- LoginDialog: 登录对话框（非页面）
- AuthGuard: 操作级别守卫（包装操作按钮）
- UserMenu: 用户菜单（顶部栏）

---

### FR-002: 布局框架

**优先级**: P0
**依赖**: 无（不再依赖 FR-001）

**描述**:
主控制台布局，包含侧边栏导航、顶部栏、内容区域。无需登录即可访问。

**验收标准**:
- [ ] 响应式侧边栏（可折叠）
- [ ] 顶部栏显示 Logo、语言切换、主题切换、用户菜单
- [ ] 面包屑导航
- [ ] 支持暗色模式
- [ ] 移动端底部导航或汉堡菜单

**UI 组件**:
- Layout: 整体布局容器
- Sidebar: 侧边栏导航
- Navbar: 顶部导航栏
- MobileMenu: 移动端菜单

---

### FR-014: 国际化支持（新增）

**优先级**: P0
**依赖**: 无

**描述**:
中日双语切换，参考 atlantis 项目实现。

**验收标准**:
- [ ] 支持中文和日文切换
- [ ] 语言偏好存储在 localStorage
- [ ] 所有 UI 文本使用 i18n key
- [ ] 语言切换器在顶部栏显示

**UI 组件**:
- I18nProvider: 国际化 Context
- LanguageSwitcher: 语言切换器

**翻译范围**:
- 导航菜单
- 按钮文本
- 表格表头
- 提示信息
- 错误消息

---

### FR-015: 主题切换（新增）

**优先级**: P0
**依赖**: 无

**描述**:
亮色/暗色模式切换，参考 atlantis 项目实现。

**验收标准**:
- [ ] 支持亮色、暗色、跟随系统三种模式
- [ ] 主题偏好存储在 localStorage
- [ ] 主题切换器在顶部栏显示
- [ ] 主题色为淡绿蓝色 (teal/cyan)

**UI 组件**:
- ThemeProvider: 主题 Context
- ThemeSwitcher: 主题切换器

---

### FR-016: 响应式布局（新增）

**优先级**: P0
**依赖**: FR-002

**描述**:
支持桌面端、平板、移动端的响应式布局。

**验收标准**:
- [ ] 桌面端: 固定侧边栏布局
- [ ] 平板: 可折叠侧边栏
- [ ] 移动端: 底部导航或汉堡菜单
- [ ] 表格在移动端转为卡片视图
- [ ] 图表自适应容器宽度

---

### FR-003: 概览 - Analysis 页面

**优先级**: P1
**依赖**: FR-002

**描述**:
集群概览分析页面，显示统计卡片和图表。无需登录可访问。

**验收标准**:
- [ ] 统计卡片显示 Node、Pod、Service、Deployment 数量
- [ ] 支持按集群筛选
- [ ] 显示资源状态分布图表

**API 依赖**:
| 方法 | 路径 | 描述 |
|------|------|------|
| POST | /uiapi/cluster/info | 获取集群信息 |
| POST | /uiapi/pod/overview | 获取 Pod 概览 |
| POST | /uiapi/node/overview | 获取 Node 概览 |

---

### FR-004: 概览 - Workbench 页面

**优先级**: P1
**依赖**: FR-001, FR-002

**描述**:
工作台页面，配置 Slack/Email/Webhook 通知等。查看无需登录，修改需登录。

**验收标准**:
- [ ] 显示 Slack 配置表单（只读）
- [ ] 修改配置时检查登录状态
- [ ] 支持启用/禁用 Slack 通知（需登录）
- [ ] 支持设置通知间隔（需登录）

**API 依赖**:
| 方法 | 路径 | 需要登录 |
|------|------|---------|
| POST | /uiapi/config/slack/get | 否 |
| POST | /uiapi/config/slack/update | 是 |

---

### FR-005: Pod 监控

**优先级**: P1
**依赖**: FR-001, FR-002

**描述**:
Pod 列表页面和详情页面。查看无需登录，操作需登录。

**验收标准**:
- [ ] Pod 列表表格（支持搜索、筛选、排序）
- [ ] Pod 详情页面显示完整信息
- [ ] 支持查看 Pod 日志（无需登录）
- [ ] 支持重启 Pod 操作（需登录）

**操作权限**:
| 操作 | 需要登录 |
|------|---------|
| 查看列表 | 否 |
| 查看详情 | 否 |
| 查看日志 | 否 |
| 重启 Pod | 是 |
| 删除 Pod | 是 |

---

### FR-006: Node 监控

**优先级**: P1
**依赖**: FR-001, FR-002

**描述**:
Node 列表页面和详情页面。查看无需登录，操作需登录。

**验收标准**:
- [ ] Node 列表表格
- [ ] Node 详情页面
- [ ] 显示 Node 资源使用情况
- [ ] 支持 Node cordon/drain 操作（需登录）

**操作权限**:
| 操作 | 需要登录 |
|------|---------|
| 查看列表 | 否 |
| 查看详情 | 否 |
| Cordon | 是 |
| Drain | 是 |

---

### FR-007: Deployment 监控

**优先级**: P2
**依赖**: FR-001, FR-002

**描述**:
Deployment 列表和详情页面。

**验收标准**:
- [ ] Deployment 列表表格
- [ ] Deployment 详情页面
- [ ] 支持扩缩容操作（需登录）
- [ ] 支持重启 Deployment（需登录）

---

### FR-008: Service 监控

**优先级**: P2
**依赖**: FR-002

**描述**:
Service 列表页面。

**验收标准**:
- [ ] Service 列表表格
- [ ] 显示 Service 端口和类型

---

### FR-009: Namespace 监控

**优先级**: P2
**依赖**: FR-002

**描述**:
Namespace 列表和 ConfigMap 详情。

**验收标准**:
- [ ] Namespace 列表表格
- [ ] ConfigMap 详情页面

---

### FR-010: Ingress 监控

**优先级**: P2
**依赖**: FR-002

**描述**:
Ingress 列表页面。

**验收标准**:
- [ ] Ingress 列表表格
- [ ] 显示 Ingress 规则

---

### FR-011: 告警监控

**优先级**: P2
**依赖**: FR-002

**描述**:
集群告警事件列表和详情。

**验收标准**:
- [ ] 告警事件列表（支持筛选）
- [ ] 告警详情显示
- [ ] AI 诊断结果展示

---

### FR-012: 系统指标监控

**优先级**: P3
**依赖**: FR-002

**描述**:
系统指标和日志查看。

**验收标准**:
- [ ] 系统指标图表
- [ ] 操作日志列表

---

### FR-013: 用户管理

**优先级**: P3
**依赖**: FR-001, FR-002

**描述**:
用户管理和审计日志。需要管理员登录。

**验收标准**:
- [ ] 用户列表管理（需登录）
- [ ] 审计日志查看

---

## 4. 优先级矩阵

| 优先级 | FR 编号 | 功能名称 | 需登录 |
|--------|---------|---------|--------|
| P0 | FR-001 | 认证系统（操作级别） | 操作时 |
| P0 | FR-002 | 布局框架 | 否 |
| P0 | FR-014 | 国际化支持 | 否 |
| P0 | FR-015 | 主题切换 | 否 |
| P0 | FR-016 | 响应式布局 | 否 |
| P1 | FR-003 | Analysis 页面 | 否 |
| P1 | FR-004 | Workbench 页面 | 修改时 |
| P1 | FR-005 | Pod 监控 | 操作时 |
| P1 | FR-006 | Node 监控 | 操作时 |
| P2 | FR-007 | Deployment 监控 | 操作时 |
| P2 | FR-008 | Service 监控 | 否 |
| P2 | FR-009 | Namespace 监控 | 否 |
| P2 | FR-010 | Ingress 监控 | 否 |
| P2 | FR-011 | 告警监控 | 否 |
| P3 | FR-012 | 系统指标监控 | 否 |
| P3 | FR-013 | 用户管理 | 是 |

---

## 5. 验收检查清单

### 核心功能

- [ ] P0 功能全部完成（FR-001, FR-002, FR-014, FR-015, FR-016）
- [ ] P1 功能全部完成（FR-003 ~ FR-006）
- [ ] P2 功能全部完成（FR-007 ~ FR-011）
- [ ] P3 功能全部完成（FR-012 ~ FR-013）

### 非功能需求

- [ ] 中日双语切换正常
- [ ] 亮色/暗色主题切换正常
- [ ] 移动端响应式布局正常
- [ ] 主题色为淡绿蓝色

### 构建验证

- [ ] `npm run build` 成功
- [ ] TypeScript 无错误
- [ ] 所有页面可访问（无需登录）

### 代码质量

- [ ] 无 ESLint 错误
- [ ] 无 any 类型
- [ ] 组件有 Props 类型定义

---

## 版本历史

| 版本 | 日期 | 变更 |
|------|------|------|
| 1.0 | 2026-01-03 | 初始版本 |
| 1.1 | 2026-01-03 | 添加新需求：取消强制登录、国际化、主题、响应式、品牌色 |
